(function($){var API_BASE='https://www.googleapis.com/calendar/v3/calendars';var fc=$.fullCalendar;var formatDate=fc.formatDate;var parseISO8601=fc.parseISO8601;var cloneDate=fc.cloneDate;var addDays=fc.addDays;var applyAll=fc.applyAll;fc.sourceNormalizers.push(function(sourceOptions){var googleCalendarId=sourceOptions.googleCalendarId;var url=sourceOptions.url;var match;if(!googleCalendarId&&url){if((match=/^[^\/]+@([^\/]+\.)?calendar\.google\.com$/.test(url))){googleCalendarId=url;}
else if((match=/^https:\/\/www.googleapis.com\/calendar\/v3\/calendars\/([^\/]*)/.exec(url))||(match=/^https?:\/\/www.google.com\/calendar\/feeds\/([^\/]*)/.exec(url))){googleCalendarId=decodeURIComponent(match[1]);}
if(googleCalendarId){sourceOptions.googleCalendarId=googleCalendarId;}}
if(googleCalendarId){if(sourceOptions.editable==null){sourceOptions.editable=false;}
sourceOptions.url=googleCalendarId;}});fc.sourceFetchers.push(function(sourceOptions,start,end){if(sourceOptions.googleCalendarId){return transformOptions(sourceOptions,start,end);}});function transformOptions(sourceOptions,start,end){var url=API_BASE+'/'+ encodeURIComponent(sourceOptions.googleCalendarId)+'/events?callback=?';var apiKey=sourceOptions.googleCalendarApiKey;var ctz=sourceOptions.currentTimezone;var success=sourceOptions.success;var data;function reportError(message,apiErrorObjs){var errorObjs=apiErrorObjs||[{message:message}];var consoleObj=window.console;var consoleWarnFunc=consoleObj?(consoleObj.warn||consoleObj.log):null;(sourceOptions.googleCalendarError||$.noop).apply(null,errorObjs);if(consoleWarnFunc){consoleWarnFunc.apply(consoleObj,[message].concat(apiErrorObjs||[]));}}
start=addDays(cloneDate(start),-1);end=addDays(cloneDate(end),1);if(!apiKey){reportError("Specify a googleCalendarApiKey. See http://fullcalendar.io/docs1/google_calendar/");return{};}
data=$.extend({},sourceOptions.data||{},{key:apiKey,timeMin:formatDate(start,'u'),timeMax:formatDate(end,'u'),singleEvents:true,maxResults:9999});if(ctz){data.timeZone=ctz=ctz.replace(' ','_');}
return $.extend({},sourceOptions,{googleCalendarId:null,url:url,data:data,startParam:false,endParam:false,success:function(data){var events=[];var successArgs;var successRes;if(data.error){reportError('Google Calendar API: '+ data.error.message,data.error.errors);}
else if(data.items){$.each(data.items,function(i,entry){var allDay=!entry.start.dateTime&&!entry.end.dateTime;var start=parseISO8601(entry.start.dateTime||entry.start.date,true);var end=parseISO8601(entry.end.dateTime||entry.end.date,true);var url=entry.htmlLink;if(allDay){addDays(end,-1);}
if(ctz){url+=(url.indexOf('?')==-1?'?':'&')+'ctz='+ ctz;}
events.push({id:entry.id,title:entry.summary,allDay:allDay,start:start,end:end,url:url,location:entry.location,description:entry.description});});successArgs=[events].concat(Array.prototype.slice.call(arguments,1));successRes=applyAll(success,this,successArgs);if($.isArray(successRes)){return successRes;}}
return events;}});}
fc.gcalFeed=function(url,sourceOptions){return $.extend({},sourceOptions,{url:url});};})(jQuery);